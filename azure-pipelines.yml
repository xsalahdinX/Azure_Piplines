trigger:
 - main
 
pool:
   name: Self-Hosted -Agent
   
variables:
    group: AWS_VARS

steps:

- task: Goge
  displayNane: "Go Get"
  inputs:
    command: 'get'
    arguments: '-d'
    workingDirectory: '$(System.DefaultworkingDirectory)'

- task: Go√üe
  displayNane: "Go Build"
  inputs:
    command: 'build'
    workingDirectory: '$(System.DefaultworkingDirectory)'
    
- task: CopyFiles@2
  inputs:
    Sourcefolder: '$(System.DefaultworkingDirectory)'
    Contents : 'deployment.yaml'
    TargetFolder: '$(System.DefaultworkingDirectory)'

- task: PublishBuildArtifacts@1
  inputs:
    artifactName: drop
    
- task: Docken@2
  displayName: Build an image
  inputs:
    command: build 
    dockerfile: '$(System.DefaulworkingDirectory)/Dockerfile'
    bulldContext: '$(System.DefaultworkingDirectory)'
    repository : $(AWS_ECR_MAGE_URI)
    
- task: ECRPushImage@1
  inputs:
    awsCredentials: 'AWS_Service'
    regionName: $(AWS_REGION) 
    imageSource: 'imagename'
    sourceImagelName: $(AWS_ECR_MAGE_URI)
    sourceImageTag: $(Build.BuildId)
    pushTag: $(Build.BuildId)
    repositoryName: $(AWS_ECR_REPOSITORY_NAME)


